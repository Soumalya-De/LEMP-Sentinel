# CVE Remediation Playbook

## Overview

This document defines the standard operating procedures for handling Common Vulnerabilities and Exposures (CVEs) discovered in the LEMP-Sentinel infrastructure.

**Last Updated:** November 9, 2025  
**Owner:** Repository maintainers  
**Review Cycle:** Quarterly

---

## Detection (Automated)

### Vulnerability Scanning

**Primary Tool:** Trivy (Aqua Security)  
**Schedule:** Every Monday at 9:00 AM UTC  
**Workflow:** `.github/workflows/cve-remediation-monitor.yml`

**What gets scanned:**
- Docker base images (PHP, Nginx, MySQL, Alpine)
- Application dependencies (PHP packages via Composer)
- System packages (Alpine Linux apk)

**Automated Actions:**
1. Trivy scans all Docker images
2. New CVEs trigger GitHub issue creation
3. Issues are labeled by severity (CRITICAL, HIGH, MEDIUM, LOW)
4. Issue includes:
   - CVE ID and CVSS score
   - Affected package and version
   - Remediation SLA deadline
   - Link to upstream fix tracker

### Supply Chain Visibility

**SBOM Generation:** Automated on every Docker build  
**Format:** SPDX JSON  
**Storage:** GitHub Actions artifacts  
**Purpose:** Quickly identify affected components when new CVEs are announced

---

## Triage Process

### Severity Definitions

| Severity | CVSS Score | SLA | Priority |
|----------|------------|-----|----------|
| CRITICAL | 9.0 - 10.0 | 7 days | P0 - Drop everything |
| HIGH | 7.0 - 8.9 | 14 days | P1 - Urgent |
| MEDIUM | 4.0 - 6.9 | 30 days | P2 - Scheduled |
| LOW | 0.1 - 3.9 | 60 days | P3 - Backlog |

### CRITICAL Severity (7-Day SLA)

**Timeline:**
- **Day 0 (Discovery):** Automated issue created, labeled `cve`, `critical`, `triage-needed`
- **Day 0-1 (Assessment):** Review CVE details, confirm applicability
- **Day 1-3 (Planning):** Identify fix/workaround, test in dev environment
- **Day 4-6 (Implementation):** Apply fix, run security scans, validate
- **Day 7 (Deployment):** Deploy to production, verify remediation

**Assessment Questions:**
1. Is this CVE actively exploited in the wild? (Check CISA KEV catalog)
2. Is the vulnerable component exposed to the internet?
3. Is there a proof-of-concept exploit available?
4. What is the blast radius if exploited?

**Response Options:**
- **Immediate patch:** If upstream fix is available and stable
- **Workaround:** Disable affected feature, add network restrictions
- **Accepted risk:** Document justification if exploitation is extremely unlikely (e.g., requires local access, specific configuration not present)

**Escalation:** If fix requires significant architecture changes, escalate to repository owner for decision.

---

### HIGH Severity (14-Day SLA)

**Timeline:**
- **Day 0-2 (Assessment):** Review CVE, check SBOM, confirm exposure
- **Day 3-7 (Testing):** Test patch in dev/staging environment
- **Day 8-12 (Implementation):** Apply fix, run integration tests
- **Day 13-14 (Deployment):** Deploy to production, monitor for issues

**Testing Checklist:**
- [ ] Patch applied successfully in dev environment
- [ ] No breaking changes to application functionality
- [ ] Security scan confirms CVE is remediated
- [ ] Performance benchmarks show no regression
- [ ] Rollback plan documented and tested

**Documentation Required:**
- Update `CVE-REMEDIATION-SUMMARY.md` with resolution
- Create PR with clear description of changes
- Tag release if update affects production images

---

### MEDIUM Severity (30-Day SLA)

**Timeline:**
- **Week 1 (Assessment):** Review and prioritize
- **Week 2-3 (Planning):** Bundle with other updates, test thoroughly
- **Week 4 (Deployment):** Deploy during regular maintenance window

**Batching Strategy:**
- Group multiple MEDIUM CVEs into single maintenance release
- Coordinate with dependency updates (e.g., Alpine Linux minor version bump)
- Minimize deployment frequency while maintaining security posture

**Example Scenario:**
```
Current: Alpine 3.21.0 with 3 MEDIUM CVEs
Action: Wait for Alpine 3.21.1 that addresses all 3
Timeline: Deploy within 30-day SLA
Benefit: Single deployment, all CVEs fixed, minimal disruption
```

---

### LOW Severity (60-Day SLA)

**Timeline:**
- **Month 1 (Assessment):** Review and document
- **Month 2 (Planning):** Include in quarterly maintenance
- **Deployment:** Next major/minor release

**Acceptance Criteria:**
- CVE requires specific conditions unlikely in production
- Exploit complexity is high with minimal impact
- Fix is non-trivial and requires careful testing

**Example:** CVE in debug-only feature that's disabled in production

---

## Current CVE Status

### Active Suppressions

**Location:** `.trivyignore`  
**Purpose:** Temporary suppression with tracking and justification

**Current Suppressions (as of November 8, 2025):**

```
# CVE-2025-49794: libxml2 Heap Use-After-Free (HIGH)
CVE-2025-49794
# Status: Awaiting Alpine Linux 3.23 release
# Upstream fix: libxml2 2.13.9-r0
# Tracking: https://gitlab.alpinelinux.org/alpine/aports/-/issues/XXXXX
# Target remediation: 2 weeks after Alpine 3.23 release
# Last checked: 2025-11-07

# CVE-2025-49796: libxml2 Type Confusion DoS (MEDIUM)
CVE-2025-49796
# Status: Awaiting Alpine Linux 3.23 release
# Upstream fix: libxml2 2.13.9-r0
# Tracking: https://gitlab.alpinelinux.org/alpine/aports/-/issues/XXXXX
# Target remediation: 2 weeks after Alpine 3.23 release
# Last checked: 2025-11-07

# CVE-2025-49795: libxml2 NULL Pointer Dereference (MEDIUM)
CVE-2025-49795
# Status: Awaiting Alpine Linux 3.23 release
# Upstream fix: libxml2 2.13.9-r0
# Tracking: https://gitlab.alpinelinux.org/alpine/aports/-/issues/XXXXX
# Target remediation: 2 weeks after Alpine 3.23 release
# Last checked: 2025-11-07

# CVE-2025-6021: libxml2 Integer Overflow (HIGH)
CVE-2025-6021
# Status: Awaiting Alpine Linux 3.23 release
# Upstream fix: libxml2 2.13.9-r0
# Tracking: https://gitlab.alpinelinux.org/alpine/aports/-/issues/XXXXX
# Target remediation: 2 weeks after Alpine 3.23 release
# Last checked: 2025-11-07
```

**Review Frequency:** Weekly (automated via GitHub Actions)  
**Remediation Plan:** Update base images to Alpine 3.23 when released, rescan to confirm fix

---

## Implementation Workflow

### Standard Remediation Process

```bash
# 1. Create fix branch
git checkout -b fix/cve-2025-xxxxx

# 2. Update affected component
# Example: Update Alpine base image
sed -i 's/alpine:3.21/alpine:3.23/' nginx/Dockerfile php/Dockerfile

# 3. Rebuild images locally
docker compose build --no-cache

# 4. Run security scan
docker run --rm \
  -v /var/run/docker.sock:/var/run/docker.sock \
  aquasec/trivy image lemp-sentinel-php:latest

# 5. Verify fix
# Check that CVE no longer appears in scan results

# 6. Run integration tests
docker compose up -d
./scripts/smoke-test.sh  # If available

# 7. Create PR
git add .
git commit -m "security: fix CVE-2025-xxxxx in libxml2

- Update Alpine base image to 3.23
- Confirms remediation via Trivy scan
- Resolves #123

Fixes CVE-2025-xxxxx (HIGH severity)
CVSS Score: 7.8
Package: libxml2 2.13.5-r0 → 2.13.9-r0"

git push origin fix/cve-2025-xxxxx

# 8. Deploy after CI passes and PR review
git checkout main
git merge --no-ff fix/cve-2025-xxxxx
git tag -a v1.2.1 -m "Security fix: CVE-2025-xxxxx"
git push origin main --tags
```

---

### Post-Remediation

### Verification Steps

1. **Rescan with Trivy:** Confirm CVE no longer detected
2. **Check SBOM:** Verify updated package versions
3. **Monitor logs:** Watch for unexpected errors (24-48 hours)
4. **Update documentation:** 
   - Remove from `.trivyignore` if present
   - Update `docs/cve-remediation.md` with remediation details
   - Close related GitHub issues with resolution details

### Communication

**Internal (Repository Contributors):**
- Close GitHub issue with summary: "Fixed in v1.2.1, deployed to production"
- Update project board status

**External (If Public Disclosure Required):**
- Add to release notes
- Update security documentation
- Consider GitHub Security Advisory if vulnerability was in project code (not dependencies)

---

## Escalation Procedures

### When to Escalate

1. **Active exploitation detected:** CRITICAL CVE with known exploits in the wild
2. **No fix available:** Upstream maintainer has not released patch within SLA window
3. **Breaking changes required:** Fix requires significant architecture changes
4. **Zero-day vulnerability:** Discovered vulnerability not yet assigned CVE

### Escalation Contacts

**Repository Owner:** @Soumalya-De  
**Security Contact:** [GitHub Security Advisories](https://github.com/Soumalya-De/LEMP-Sentinel/security/advisories)  
**Response Time:** Within 24 hours for CRITICAL, 72 hours for HIGH

---

## Special Scenarios

### Scenario 1: Upstream Fix Not Available

**Problem:** CVE published, but no patch released by upstream maintainer

**Options:**
1. **Workaround:** Implement temporary mitigation (e.g., WAF rule, network restriction)
2. **Alternative package:** Switch to different implementation (e.g., libxml2 → alternative XML parser)
3. **Accepted risk:** Document justification and monitoring plan
4. **Pin version:** Prevent automatic updates that might introduce new issues

**Documentation Template:**
```markdown
## CVE-2025-XXXXX: [Title]

**Status:** Accepted Risk (Temporary)  
**Justification:**
- No upstream fix available as of [DATE]
- Exploitation requires [SPECIFIC CONDITIONS]
- Mitigation in place: [WORKAROUND DESCRIPTION]
- Monitoring: [DETECTION STRATEGY]
- Review date: [DATE] (recheck for fix availability)
```

---

### Scenario 2: False Positive

**Problem:** Trivy flags CVE that doesn't apply to our configuration

**Process:**
1. Verify CVE details and affected configuration
2. Document why it's not applicable
3. Add to `.trivyignore` with detailed explanation
4. Schedule quarterly review to reconfirm

**Example:**
```
# CVE-2025-12345: PHP session handling vulnerability
CVE-2025-12345
# False positive: We use Redis for session storage, not filesystem
# Vulnerable code path is not used in our configuration
# Verified: 2025-11-09
# Review date: 2026-02-09
```

---

### Scenario 3: Dependency Conflict

**Problem:** CVE fix requires package update that breaks compatibility

**Decision Matrix:**

| Impact | Fix Available | Action |
|--------|---------------|--------|
| CRITICAL | Yes, breaking | Accept breaking changes, fix app code |
| CRITICAL | No | Implement workaround, document risk |
| HIGH | Yes, breaking | Schedule refactor, implement temporary mitigation |
| HIGH | No | Accept risk with monitoring, document |
| MEDIUM/LOW | Yes, breaking | Defer to next major version |
| MEDIUM/LOW | No | Accept risk, document |

**Example Workflow:**
```bash
# Test fix in isolated environment
docker compose -f docker-compose.test.yml up -d

# Run compatibility tests
./scripts/compatibility-tests.sh

# If tests fail, implement adapter pattern or feature flag
# Document technical debt and schedule refactor
```

---

## Metrics & Reporting

### Key Performance Indicators

**SLA Compliance:**
- % of CRITICAL CVEs fixed within 7 days
- % of HIGH CVEs fixed within 14 days
- Average time to remediation by severity

**Current Baseline (as of November 2025):**
- 4 HIGH/MEDIUM CVEs tracked
- All within SLA windows
- 0 CRITICAL CVEs outstanding

### Monthly Report Template

```markdown
## CVE Remediation Report - [MONTH YEAR]

**Summary:**
- New CVEs discovered: [COUNT]
- CVEs remediated: [COUNT]
- Open CVEs: [COUNT]
- SLA compliance: [PERCENTAGE]

**Details:**
| CVE ID | Severity | Discovered | Fixed | SLA Status |
|--------|----------|------------|-------|------------|
| CVE-2025-XXXXX | HIGH | 2025-11-01 | 2025-11-10 | ✅ On time |

**Trends:**
- [Analysis of patterns, recurring issues, etc.]

**Action Items:**
- [Any process improvements needed]
```

---

## Continuous Improvement

### Process Review

**Frequency:** Quarterly  
**Review Questions:**
1. Are SLA timelines still realistic?
2. Are scanning tools detecting vulnerabilities accurately?
3. Have we had any security incidents related to CVEs?
4. What process improvements can we make?

### Tool Updates

**Trivy:** Update to latest version monthly  
**SBOM Format:** Review for new standards (e.g., SPDX 3.0, CycloneDX updates)  
**Scanning Coverage:** Ensure all components are included

---

## References

**Internal Documentation:**
- [CVE Remediation Strategy](./cve-remediation.md)
- [Security Hardening Guide](./security-hardening.md)
- [CI/CD Workflows](./ci-cd-workflows.md)

**External Resources:**
- [NIST National Vulnerability Database](https://nvd.nist.gov/)
- [CISA Known Exploited Vulnerabilities](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
- [Trivy Documentation](https://aquasecurity.github.io/trivy/)
- [Alpine Linux Security](https://security.alpinelinux.org/)
- [FIRST CVSS Calculator](https://www.first.org/cvss/calculator/4.0)

---

## Changelog

| Date | Change | Author |
|------|--------|--------|
| 2025-11-09 | Initial playbook creation | @Soumalya-De |
